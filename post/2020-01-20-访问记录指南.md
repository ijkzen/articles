---
title: 访问记录指南
categories: tutorial
---



# 访问记录指南

## 记录策略

记录策略是为了控制访问记录入库而产生，更加通俗地说就是用来控制哪些请求能够入库，哪些不能入库。

记录策略需要能够通过API进行动态设置。

### 全部记录策略

顾名思义，对所有的请求不作过滤，全部入库，包括所有的静态资源和API请求

### 普通记录策略

全部记录虽然很好地保留了所有数据，但是对个人博客来说仍然太过庞杂；通过观察，最多的一类请求就是对静态资源的请求；

所以当前策略对静态资源的请求入库有所限制，但是仍然留有余地；

这里维护了一个静态资源的白名单，如果在白名单内，便会入库；

默认情况下，这个白名单是空的，可以通过后台界面添加/删除；

此外，当前策略还保留了所有的API请求。

### 严格记录策略

当前策略是在**普通记录策略**的基础上，增加了对API请求的限制；

这里维护一个API请求的白名单，白名单通过注解处理器产生，凡是被`@HaloRecord`进行注解的类或者方法，便会获取它的`url`进入白名单，同样可以通过后台进行添加/删除。

在默认情况下，使用**普通记录策略**。

## 记录留存

虽然上面通过各种策略控制记录的大小，但是日积月累，记录仍然不免变大；

需要在后台实时展示当前数据库记录的条数还有存储占用，并且提供接口让用户删除指定日期之前的所有记录。

删除之前，让用户再三确认；

## 陈列

搜集访问数据并不是简单的搜集，最终还是为了展示，可以以下面几个维度思考：

1. 时间，日请求/周请求/月请求/年请求/总请求
2. 浏览器，不同浏览器在所有访问者中的占比
3. 操作系统，不同操作系统在所有访问者中的占比
4. 地区，不同地区的访问记录计数
5. IP，日新增/周新增/月新增/年新增/总人数
6. URL，最常访问的文章

## 影响

上述操作肯定会对原来的系统造成影响，需要测试进行确定，主要测试内存和响应时间；